<div class="container py-5 animate__animated animate__fadeIn">
  <div class="row justify-content-center mb-4">
    <div class="col-md-6" *ngIf="isSuperAdmin && !company_id">
      <select
        id="companyId"
        class="form-select"
        (ngModelChange)="getCompanyUsers($event)"
        [(ngModel)]="selectedCompany"
      >
        <option
          *ngFor="let company of companies"
          [value]="company.id"
          [disabled]="!company.id"
        >
          {{ company.name }}
        </option>
      </select>
    </div>
  </div>

  <div class="d-flex justify-content-center my-4">
    <button class="btn btn-primary rounded-pill px-4" (click)="showDialog()">
      <i class="bi bi-plus-circle me-2"></i> Add User
    </button>
  </div>

  <table
    class="table table-bordered table-hover mt-5 animate__animated animate__fadeIn"
    *ngIf="users?.length"
  >
    <thead class="table-light">
      <tr>
        <th>Id</th>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>{{ user.id }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.roleId === 1 ? "Admin" : "User" }}</td>
        <td class="text-center">
          <i
            class="pi pi-pencil text-primary me-3"
            style="cursor: pointer"
            (click)="showDialog('Edit', user)"
          ></i>
          <i
            class="pi pi-trash text-danger"
            style="cursor: pointer"
            (click)="delete(user.id)"
          ></i>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- User Dialog -->
<p-dialog
  header="{{ title ? 'Edit User' : 'Add User' }}"
  [(visible)]="isVisible"
  (onHide)="hideDialog()"
  [modal]="true"
  [style]="{ width: '490px' }"
  [draggable]="false"
  [resizable]="false"
  [dismissableMask]="true"
  [breakpoints]="{}"
  [styleClass]="'custom-dialog'"
>
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <div class="row g-3 mb-3">
      <div class="col-md-6">
        <label for="name" class="form-label">Name</label>
        <input
          id="name"
          formControlName="name"
          type="text"
          class="form-control"
        />
      </div>

      <div class="col-md-6">
        <label for="email" class="form-label">Email</label>
        <input
          id="email"
          formControlName="email"
          type="email"
          class="form-control"
        />
      </div>

      <div class="col-md-6">
        <label for="password" class="form-label">Password</label>
        <input
          id="password"
          formControlName="password"
          type="password"
          class="form-control"
        />
      </div>

      <div class="col-md-6">
        <label for="roleId" class="form-label">Role</label>
        <select id="roleId" formControlName="roleId" class="form-select">
          <option [value]="1">Admin</option>
          <option [value]="2">User</option>
        </select>
      </div>

      <div class="col-md-6">
        <label for="companyIdInput" class="form-label">Company ID</label>
        <input
          id="companyIdInput"
          formControlName="companyId"
          type="number"
          class="form-control"
        />
      </div>
    </div>
    <p-footer class="dialog-footer">
      <div class="dialog-actions">
        <button
          pButton
          type="submit"
          label="Save"
          class="p-button-success"
          [disabled]="userForm.invalid"
        ></button>
      </div>
    </p-footer>
  </form>
</p-dialog>
